// Generated by CoffeeScript 1.6.3
/*
  irc-message
  Copyright (c) 2013 Fionn Kelleher. All rights reserved.
  Licensed under the BSD 2-Clause License (FreeBSD) - see LICENSE.md.
*/

var Message, MessageStream, Transform, exports, util;

Transform = require("stream").Transform;

Message = require("irc-message");

util = require("util");

MessageStream = (function() {
  function MessageStream(options) {
    if (options == null) {
      options = {};
    }
    options.objectMode = true;
    Transform.call(this, options);
    this.buffer = "";
  }

  return MessageStream;

})();

util.inherits(MessageStream, Transform);

MessageStream.prototype._transform = function(chunk, encoding, done) {
  var line, lines, message, _i, _len;
  this.buffer += chunk.toString();
  lines = this.buffer.split("\r\n");
  this.buffer = lines.pop();
  for (_i = 0, _len = lines.length; _i < _len; _i++) {
    line = lines[_i];
    this.emit("line", line);
    message = Message(line);
    if (message !== null) {
      this.push(message);
    } else {
      this.emit("error", new Error("Unparsable IRC message received."));
    }
  }
  return done();
};

exports = module.exports = MessageStream;
